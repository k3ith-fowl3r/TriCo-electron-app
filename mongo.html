<!DOCTYPE html>
<html>
<head>
	<title>TriCO (MongoDB)</title>
	<link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
	<style>
		*{
			font-size: 17px;
		}
	</style>
</head>
<body>
	<div class="container-fluid">
		<div class="row">
			<div class="col-12">
				<br>
				<form enctype="multipart/form-data" style="border: 0.10px solid black;padding: 10%;">
					<center>
						<div class="form-group form-check form-check-inline" onclick="checkCustom();">
							<input type="checkbox" class="form-check-input" id="custom" name="custom">
							<label class="form-check-label" for="custom">Custom Start-end</label>
						</div>
					</center>
					<div id="customSE" style="display: none;">
						<div class="form-group">
							<label for="rowS">Starting Row</label>
							<input type="text" id="rowS" placeholder="The Heading Row" class="form-control">
						</div>
						<div class="form-group">
							<label for="rowE">Ending Row Number</label>
							<input type="text" id="rowE" placeholder="Ending Row Number" class="form-control">
						</div>
						<div class="form-group">
							<label for="colS">Starting Column</label>
							<input type="text" id="colS" placeholder="Starting Column Number" class="form-control">
						</div>
						<div class="form-group">
							<label for="colE">Ending Row column</label>
							<input type="text" id="colE" placeholder="Ending Column Number" class="form-control">
						</div>
					</div>
					<div class="form-group">
						<label for="db">Enter the name of your existing DB</label>
						<input type="text" id="db" placeholder="Created DB name" class="form-control">
					</div>
					<div class="form-group">
						<label for="table">Enter the desired table name</label>
						<input type="text" id="table" placeholder="Table name" class="form-control">
					</div>
					<div class="form-group">
						<label for="table">Upload a single excel file</label>
						<input type="file" id="file" class="form-control">
					</div>
					<center>
						<button type="submit" class="btn btn-primary" style="width:30%;">Submit</button>
					</center>
				</form>
				<hr>
				<div class="footer" style="display:none;">
					<div class="progress">
						<div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
					</div>
					<label class="small"></label>
				</div>
			</div>
		</div>
	</div>
</body>
<script>
	window.$ = window.jQuery = require('jquery');
	window.Bootstrap = require('bootstrap');
</script>
<script>
	$(document).ready(function(){
		$('#formLogin').modal({
			backdrop: 'static',
			keyboard: false
		});
		$('#formLogin').modal('show');
	});
	$('#formLogin').on('hidden.bs.modal', function (e) {
		$('#formLogin').modal('show');
	});
	var electron = require('electron');
	var {ipcRenderer} = electron;
	$("form").on("submit", function(e){
		e.preventDefault();
		var inf = $("#file")[0];
		if(inf.files.length === 0){
			alert('No file choosen!');
		}
		else{
			$(".small").html('Establishing connection and creating table');
			$(".footer").show();
			var item = {
				db: $("#db").val(),
				path: inf.files[0].path,
				table: $("#table").val(),
			};
			if($("#custom").is(":checked")){
				item.customStartEnd = true;
				item.rowS = $("#rowS").val();
				item.rowE = $("#rowE").val();
				item.colS = $("#colS").val();
				item.colE = $("#colE").val();
			}
			if(item.customStartEnd){
				if(!(item.rowS && item.rowE && item.colS && item.colE)){
					alert('All the 4 fields must be defined when Custom Start-End is Checked!');
					$(".small").html('Error');
					return;
				}
			}
			console.log(item);
			ipcRenderer.send('readXlsForMongo', item);
		}
	});
	function checkCustom(){
		console.log('checking');
		if($("#custom").is(":checked")){
			console.log('working');
			$("#customSE").show();
		}
		else{
			$("#customSE").hide();
		}	
	}
	ipcRenderer.on('startup', function(e, item){
		$("#db").val(item[0].db);
		$("#table").val(item[0].table);
	});
	ipcRenderer.on('progress', function(e, item){
		console.log(item);
		if(item == 'ER_BAD_DB_ERROR'){
			$(".small").html('DB Not found!');
		}
		if(item == 'ER_ACCESS_DENIED_ERROR'){
			$(".small").html('Access Denied!');
		}
		if(item == 'ER_TABLE_EXISTS_ERROR'){
			$(".small").html('Table already exists!');
		}
		if(item>0 && item!=1){
			$(".small").html('Inserting Records');
			$(".progress-bar").css('width', item*100+'%');
			$(".progress-bar").attr('aria-valuenow', item*100);
			$(".progress-bar").html(Math.floor(item*100)+'%');
		}
		else if(item == 1){
			$(".small").html('Done!');
			$(".progress-bar").css('width', 0);
			$(".progress-bar").attr('aria-valuenow', 0);
			$(".progress-bar").html(0);
			setTimeout(function(){$(".small").html("");$(".footer").hide();}, 2000);
		}
	});
</script>
</html>